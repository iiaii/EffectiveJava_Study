# #EffectiveJava/9장_일반적인프로그래밍원칙/67최적화


## 67. 최적화는 신중히 하라

```
(맹목적인 어리석음을 포함해) 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다(심지어 효율을 높이지도 못하면서)
```
— 윌리엄 울프

```
(전체의 97% 정도인) 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다
```
— 도널드 크누스

```
최적화를 할 때는 다음 두 규칙을 따라야한다
1. 하지 마라.
2. (전문가 한정) 아직 하지 마라. 다시 말해, 완전히 명백하고 최적화되지 않은 해법을 찾을 때까지는 하지 마라
```
— M.A 잭슨


최적화는 좋은 결과보다는 해로운 결과로 이어지기 쉽고, 섣불리 진행하면 더 그렇다. 빠르지도 않고 제대로 동작하지도 않으면서 수정하기는 어려운 소프트웨어를 탄생시킨다.

성능 때문에 견고한 구조를 희생하지 말자. 
**빠른 프로그램보다는 좋은 프로그램을 작성하라**


좋은 프로그램은 정보 은닉 원칙을 따르므로 개별 구성요소의 내부를 독립적으로 설계할 수 있다. 시스템의 나머지에 영향을 주지 않고도 각 요소를 다시 설계할 수 있다.(아이템15) 설계 단계에서 성능을 반드시 염두하는 것이 중요하다

- 성능을 제한하는 설계를 피하라

완성후 변경하기 가장 어려운 설계요소는 컴포넌트끼리, 혹은 외부 시스템과의 소통 방식이다. API 네트워크 프로토콜, 영구 저장용 데이터 포맷 등이 대표적이다. 이런 설계 요소들은 완성후에는 변경하기 어렵거나 불가능할 수 있으며, 동시에 시스템 성능을 심각하게 제한할 수 있다.

- API를 설계할 때 성능에 주는 영향을 고려하라

public 타입을 가변으로 만들면, 즉 내부 데이터를 변경할 수 있게 만들면 불필요한 방어적 복사를 수없이 유발할 수 있다. 비슷하게 컴포지션으로 해결할 수 있음에도 상속 방식으로 설계한 public 클래스는 상위 클래스에 영원히 종속되며 그 성능 제약까지도 물려받게 된다.(아이템18) 인터페이스도 있는데 굳이 구현 타입을 사용하는 것 역시 좋지 않다. (특정 구현체에 종속되게 하여, 나중에 더 빠른 구현체가 나오더라도 이용하지 못하게 된다(아이템64))


API 설계가 성능에 주는 영향은 현실적인 문제다. java.awt.Component 클래스의 getSize를 반환하도록 결정했다. 여기에 더해 Dimension은 가변으로 설계했으니 getSize를 호출하는 모든 곳에서 Dimension 인스턴스를 (방어적으로 복사하느라) 새로 생성해야만 한다. (수백만개를 생성해야 한다면 문제가 됨)

Dimension을 불변으로 만드는게 가장 이상적이지만, getSize를 getWidth와 getHeight로 나누는 방법도 있다. (기본 타입 값들을 따로 반환하는 방식)


잘 설계된 API는 성능도 좋은게 보통이다. 성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다. 
각각의 최적화 시도 전후로 성능을 측정하여 보수적으로 적용하라. (프로파일링 도구 활용)


**::핵심 정리::** 

> 빠른 프로그램을 작성하려 안달하지 말자. 좋은 프로그램을 작성하다 보면 성능은 따라오기 마련이다. 하지만 시스템을 설계할때, API, 네트워크 프로토콜, 영구 저장용 데이터 포맷을 설계할 때는 성능을 염두에 두어야 한다. 시스템을 구현했다면 성능을 측정하고 느리면 프로파일러를 사용해 원인을 찾아 최적화를 수행하라.




